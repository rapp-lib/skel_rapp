{{assign "page_title" "製品管理 入力"}}
{{inc path="/include/admin_header.html"}}

<h1 class="page-title">{{$page_title}}</h1>

{{if $forms.entry->getErrors()}}
    <p class="errmsg">※入力エラーがあります</p>
{{/if}}
{{script require=["app.observeForm"]}}
    $(function(){
        var state = {{$forms.entry->exportState()|json_encode nofilter}};
        var form = observeForm($("form.form-entry"), state, "admin");
    });
{{/script}}

{{form action='.'|page_to_url enctype="multipart/form-data" method="post" form=$forms.entry class="form-entry"}}
{{input name="id" type="hidden"}}
<table class="tbl detail">
    <tr>
        <th>大分類ID</th>
        <td>{{input name="parent_category_id" type="select" values=$enum["Product.product_category"]}}</td>
    </tr>
    <tr>
        <th>中分類ID</th>
        <td>{{input name="child_category_id" type="select" values=$enum["Product.product_category"]}}</td>
    </tr>
    <tr>
        <th>製品名</th>
        <td>{{input name="name" type="text" class="w-full"}}</td>
    </tr>
    <tr>
        <th>型名</th>
        <td>{{input name="model" type="text" class="w-full"}}</td>
    </tr>
    <tr>
        <th>画像</th>
        <td>{{input name="image" type="file"}}{{if $forms.entry.image}}<span> <a href="{{$forms.entry.image}}" target="_blank" class="uploaded">ファイル</a> <a href="javascript:void(0);" onclick="$(this).parent().parent().find('input.uploaded').val('').change();$(this).parent().hide();">削除</a></span>{{/if}}</td>
    </tr>
    <tr>
        <th>取扱説明書</th>
        <td>{{input name="manual" type="file"}}{{if $forms.entry.manual}}<span> <a href="{{$forms.entry.manual}}" target="_blank" class="uploaded">ファイル</a> <a href="javascript:void(0);" onclick="$(this).parent().parent().find('input.uploaded').val('').change();$(this).parent().hide();">削除</a></span>{{/if}}</td>
    </tr>
    <tr>
        <th>公開日</th>
        <td>{{input name="release_date" type="text" class="w-full"}}</td>
    </tr>
    <tr>
        <th>説明</th>
        <td>{{input name="description" type="textarea"}}</td>
    </tr>
    <tr>
        <th>ステータス</th>
        <td>{{input name="status" type="hidden"}}</td>
    </tr>
    <tr>
        <th>関連ファイル</th>
        <td>
            <div class="mi" data-minItems="0" data-maxItems="1000">
                <input type="hidden" name="relation_products"/>
                {{input_fieldset name="relation_products" tmpl="${id}" key="key" assign="fieldset"}}
                    <div class="mi-item" data-itemId="{{$key}}">
                        {{input type="hidden" name="relation_products[$key][id]"}}
                        {{input type="hidden" name="relation_products[$key][ord_seq]" class="mi-item-seq"}}
                        <table class="tbl detail">
                        <tr>
                            <th>ファイル種別</th>
                            <td class="input-block">{{input name="relation_products[$key][class]" type="select" values=$enum["RelationProduct.class"]}}</td>
                        </tr>
                        <tr>
                            <th>ファイル属性</th>
                            <td class="input-block">{{input name="relation_products[$key][common_information_id]" type="select" values=$enum["RelationProduct.common_information"]}}</td>
                        </tr>
                        <tr>
                            <th>ファイル</th>
                            <td class="input-block">{{input name="relation_products[$key][file]" type="file"}}{{if $forms.entry.relation_products[$key].file}}<span> <a href="{{$forms.entry.relation_products[$key].file}}" target="_blank" class="uploaded">ファイル</a> <a href="javascript:void(0);" onclick="$(this).parent().parent().find('input.uploaded').val('').change();$(this).parent().hide();">削除</a></span>{{/if}}</td>
                        </tr>
                        <tr>
                            <th>リンク</th>
                            <td class="input-block">{{input name="relation_products[$key][link]" type="text" class="w-full"}}</td>
                        </tr>
                        <tr>
                            <th>公開日</th>
                            <td class="input-block">{{input name="relation_products[$key][release_date]" type="text" class="w-full"}}</td>
                        </tr>
                        <tr>
                            <th>説明</th>
                            <td class="input-block">{{input name="relation_products[$key][description]" type="textarea"}}</td>
                        </tr>
                        <tr>
                            <th>ステータス</th>
                            <td class="input-block">{{input name="relation_products[$key][status]" type="radioselect" values=$enum["RelationProduct.status"]}}</td>
                        </tr>
                        <tr>
                            <th></th>
                            <td><a href="javascript:void(0);" class="mi-item-remove">削除</a></td>
                        </tr>
                        </table>
                    </div>
                {{/input_fieldset}}
                {{foreach $fieldset.items as $item}}{{$item nofilter}}{{/foreach}}
                <script type="text/template" class="mi-tmpl mi-anchor">{{$fieldset.tmpl nofilter}}</script>
                <a href="javascript:void(0);" class="mi-append">追加</a>
            </div>
            {{script require="rui.mi"}}{{/script}}
        </td>
    </tr>
</table>
<div class="btn-area">
    <a href='{{"admin_product.list"|page_to_url:["back"=>1]}}' class="back-btn">戻る</a>
    <div class="right clearfix">
        <button type="submit" class="primary-btn">確認</button>
    </div>
</div>
{{/form}}

{{inc path="/include/admin_footer.html"}}
